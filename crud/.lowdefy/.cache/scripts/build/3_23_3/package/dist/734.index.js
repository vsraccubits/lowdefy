exports.id=734,exports.ids=[734],exports.modules={3734:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createContext:()=>G,default:()=>K});var o=r(3729);const n=function(e){const t={};return function(r){return t[r]||(t[r]=e(r)),Promise.resolve(t[r])}};var a=r(5622),s=r.n(a),i=r(9189);const c=function(e){if(o.type.isNone(e))throw new Error("Failed to create cache key, location is undefined.");if(!o.type.isString(e.url))throw new Error("Location url definition should be a string.");return e.url.replace(/~/g,"_tilde_").replace(/\^/g,"_caret_").replace(/\*/g,"_star_").replace(/[^a-zA-Z0-9-_]/g,"_").toLowerCase().replace(/_json$/,".json")},p=JSON.parse('{"name":"@lowdefy/build","version":"3.23.3","licence":"Apache-2.0","description":"","homepage":"https://lowdefy.com","keywords":["lowdefy"],"bugs":{"url":"https://github.com/lowdefy/lowdefy/issues"},"contributors":[{"name":"Sam Tolmay","url":"https://github.com/SamTolmay"},{"name":"Gerrie van Wyk","url":"https://github.com/Gervwyk"}],"repository":{"type":"git","url":"https://github.com/lowdefy/lowdefy.git"},"main":"dist/index.js","files":["dist/*"],"scripts":{"build":"yarn webpack","clean":"rm -rf dist","prepare":"yarn build","test":"jest --coverage","webpack":"webpack --config webpack.config.js"},"dependencies":{"@lowdefy/ajv":"3.23.3","@lowdefy/helpers":"3.23.3","@lowdefy/node-utils":"3.23.3","@lowdefy/nunjucks":"3.23.3","ajv":"6.12.6","axios":"0.21.4","js-yaml":"4.1.0","json5":"2.2.0","uuid":"8.3.2"},"devDependencies":{"@babel/cli":"7.14.3","@babel/core":"7.14.3","@babel/preset-env":"7.14.4","babel-jest":"26.6.3","babel-loader":"8.2.2","clean-webpack-plugin":"3.0.0","jest":"26.6.3","webpack":"5.38.1","webpack-cli":"4.7.0"},"publishConfig":{"access":"public"}}'),{version:l}=p,d=function({blocksServerUrl:e}){let t=e;return o.type.isNone(t)&&(t=`https://blocks-cdn.lowdefy.com/v${l}`),{Context:{url:`${t}/blocks-basic/meta/Context.json`},Box:{url:`${t}/blocks-basic/meta/Box.json`},DangerousHtml:{url:`${t}/blocks-basic/meta/DangerousHtml.json`},Html:{url:`${t}/blocks-basic/meta/Html.json`},Img:{url:`${t}/blocks-basic/meta/Img.json`},List:{url:`${t}/blocks-basic/meta/List.json`},Span:{url:`${t}/blocks-basic/meta/Span.json`},Affix:{url:`${t}/blocks-antd/meta/Affix.json`},Alert:{url:`${t}/blocks-antd/meta/Alert.json`},Anchor:{url:`${t}/blocks-antd/meta/Anchor.json`},AutoComplete:{url:`${t}/blocks-antd/meta/AutoComplete.json`},Avatar:{url:`${t}/blocks-antd/meta/Avatar.json`},Badge:{url:`${t}/blocks-antd/meta/Badge.json`},Breadcrumb:{url:`${t}/blocks-antd/meta/Breadcrumb.json`},Button:{url:`${t}/blocks-antd/meta/Button.json`},ButtonSelector:{url:`${t}/blocks-antd/meta/ButtonSelector.json`},Card:{url:`${t}/blocks-antd/meta/Card.json`},CheckboxSelector:{url:`${t}/blocks-antd/meta/CheckboxSelector.json`},CheckboxSwitch:{url:`${t}/blocks-antd/meta/CheckboxSwitch.json`},Collapse:{url:`${t}/blocks-antd/meta/Collapse.json`},Comment:{url:`${t}/blocks-antd/meta/Comment.json`},ConfirmModal:{url:`${t}/blocks-antd/meta/ConfirmModal.json`},Content:{url:`${t}/blocks-antd/meta/Content.json`},ControlledList:{url:`${t}/blocks-antd/meta/ControlledList.json`},DateRangeSelector:{url:`${t}/blocks-antd/meta/DateRangeSelector.json`},DateSelector:{url:`${t}/blocks-antd/meta/DateSelector.json`},DateTimeSelector:{url:`${t}/blocks-antd/meta/DateTimeSelector.json`},Descriptions:{url:`${t}/blocks-antd/meta/Descriptions.json`},Divider:{url:`${t}/blocks-antd/meta/Divider.json`},Drawer:{url:`${t}/blocks-antd/meta/Drawer.json`},Footer:{url:`${t}/blocks-antd/meta/Footer.json`},Header:{url:`${t}/blocks-antd/meta/Header.json`},Icon:{url:`${t}/blocks-antd/meta/Icon.json`},Label:{url:`${t}/blocks-antd/meta/Label.json`},Layout:{url:`${t}/blocks-antd/meta/Layout.json`},Menu:{url:`${t}/blocks-antd/meta/Menu.json`},Message:{url:`${t}/blocks-antd/meta/Message.json`},MobileMenu:{url:`${t}/blocks-antd/meta/MobileMenu.json`},Modal:{url:`${t}/blocks-antd/meta/Modal.json`},MonthSelector:{url:`${t}/blocks-antd/meta/MonthSelector.json`},MultipleSelector:{url:`${t}/blocks-antd/meta/MultipleSelector.json`},Notification:{url:`${t}/blocks-antd/meta/Notification.json`},NumberInput:{url:`${t}/blocks-antd/meta/NumberInput.json`},PageHCF:{url:`${t}/blocks-antd/meta/PageHCF.json`},PageHCSF:{url:`${t}/blocks-antd/meta/PageHCSF.json`},PageHeaderMenu:{url:`${t}/blocks-antd/meta/PageHeaderMenu.json`},PageHSCF:{url:`${t}/blocks-antd/meta/PageHSCF.json`},PageSHCF:{url:`${t}/blocks-antd/meta/PageSHCF.json`},PageSiderMenu:{url:`${t}/blocks-antd/meta/PageSiderMenu.json`},Pagination:{url:`${t}/blocks-antd/meta/Pagination.json`},Paragraph:{url:`${t}/blocks-antd/meta/Paragraph.json`},ParagraphInput:{url:`${t}/blocks-antd/meta/ParagraphInput.json`},PasswordInput:{url:`${t}/blocks-antd/meta/PasswordInput.json`},Progress:{url:`${t}/blocks-antd/meta/Progress.json`},RadioSelector:{url:`${t}/blocks-antd/meta/RadioSelector.json`},RatingSlider:{url:`${t}/blocks-antd/meta/RatingSlider.json`},Result:{url:`${t}/blocks-antd/meta/Result.json`},S3UploadButton:{url:`${t}/blocks-antd/meta/S3UploadButton.json`},Selector:{url:`${t}/blocks-antd/meta/Selector.json`},Slider:{url:`${t}/blocks-antd/meta/Slider.json`},Skeleton:{url:`${t}/blocks-antd/meta/Skeleton.json`},Spin:{url:`${t}/blocks-antd/meta/Spin.json`},Statistic:{url:`${t}/blocks-antd/meta/Statistic.json`},Switch:{url:`${t}/blocks-antd/meta/Switch.json`},Tabs:{url:`${t}/blocks-antd/meta/Tabs.json`},TextArea:{url:`${t}/blocks-antd/meta/TextArea.json`},TextInput:{url:`${t}/blocks-antd/meta/TextInput.json`},TimelineList:{url:`${t}/blocks-antd/meta/TimelineList.json`},Title:{url:`${t}/blocks-antd/meta/Title.json`},TitleInput:{url:`${t}/blocks-antd/meta/TitleInput.json`},Tooltip:{url:`${t}/blocks-antd/meta/Tooltip.json`},UserAvatar:{url:`${t}/blocks-antd/meta/UserAvatar.json`},WeekSelector:{url:`${t}/blocks-antd/meta/WeekSelector.json`},ColorSelector:{url:`${t}/blocks-color-selectors/meta/ColorSelector.json`},ChromeColorSelector:{url:`${t}/blocks-color-selectors/meta/ChromeColorSelector.json`},CircleColorSelector:{url:`${t}/blocks-color-selectors/meta/CircleColorSelector.json`},CompactColorSelector:{url:`${t}/blocks-color-selectors/meta/CompactColorSelector.json`},GithubColorSelector:{url:`${t}/blocks-color-selectors/meta/GithubColorSelector.json`},SliderColorSelector:{url:`${t}/blocks-color-selectors/meta/SliderColorSelector.json`},SwatchesColorSelector:{url:`${t}/blocks-color-selectors/meta/SwatchesColorSelector.json`},TwitterColorSelector:{url:`${t}/blocks-color-selectors/meta/TwitterColorSelector.json`},Markdown:{url:`${t}/blocks-markdown/meta/Markdown.json`},MarkdownWithCode:{url:`${t}/blocks-markdown/meta/MarkdownWithCode.json`},DangerousMarkdown:{url:`${t}/blocks-markdown/meta/DangerousMarkdown.json`},EChart:{url:`${t}/blocks-echarts/meta/EChart.json`}}};var u=r(9949),y=r.n(u);const g=function({components:e,context:t}){const{blocksServerUrl:r,cacheDirectory:a}=t,{types:p}=e,l={...d({blocksServerUrl:r}),...p},u=function({cacheDirectory:e}){return async function(t){const r=c(t),o=await(0,i.readFile)(s().resolve(e,"meta/",r));return JSON.parse(o)}}({cacheDirectory:a}),g=function({cacheDirectory:e}){return async function({location:t,meta:r}){const o=c(t);return(0,i.writeFile)({filePath:s().resolve(e,"meta/",o),content:JSON.stringify(r,null,2)})}}({cacheDirectory:a});return n((async function(e){const t=l[e];if(!t)throw new Error(`Block type ${JSON.stringify(e)} is not defined. Specify type url in types array.`);const r=!t.url.startsWith("http://localhost:");let n;if(r&&(n=await u(t),n))return n;if(n=await async function({location:e,type:t}={}){if(o.type.isNone(e))throw new Error("Failed to fetch meta, location is undefined.");if(!o.type.isString(e.url))throw new Error(`Block type ${JSON.stringify(t)} url definition should be a string.`);let r;try{r=await y().get(e.url)}catch(r){if(r.response&&404===r.response.status)throw new Error(`Meta for type ${JSON.stringify(t)} could not be found at ${JSON.stringify(e)}.`);throw r}return r.data}({location:t,type:e}),n&&o.type.isString(n.category)&&n.moduleFederation)return r&&await g({location:t,meta:n}),n;throw new Error(`Block type ${JSON.stringify(e)} has invalid block meta at ${JSON.stringify(t)}.`)}))},f=function({outputDirectory:e}){return async function({filePath:t,content:r}){return(0,i.writeFile)({filePath:s().resolve(e,t),content:r})}},b=function({configDirectory:e}){return n((async function(t){return(0,i.readFile)(s().resolve(e,t))}))},h=JSON.parse('{"id":"404","type":"Context","style":{"minHeight":"100vh"},"blocks":[{"id":"404_result","type":"Result","properties":{"status":404,"title":"404","subTitle":"Sorry, the page you are visiting does not exist."},"areas":{"extra":{"blocks":[{"id":"home","type":"Button","properties":{"title":"Go to home page","type":"Link","icon":"HomeOutlined"},"events":{"onClick":[{"id":"home","type":"Link","params":{"home":true}}]}}]}}}]}'),m=function({components:e}){const t=function({components:e}){const t=(e.pages||[]).map((e=>e.id));let r=[];return o.type.isArray(e.config.auth.pages.public)?r=t.filter((t=>!e.config.auth.pages.public.includes(t))):!0===e.config.auth.pages.protected?r=t:o.type.isArray(e.config.auth.pages.protected)&&(r=e.config.auth.pages.protected),r}({components:e}),r=function({components:e}){const t=e.config.auth.pages.roles,r={};return Object.keys(t).forEach((e=>{t[e].forEach((t=>{r[t]||(r[t]=new Set),r[t].add(e)}))})),Object.keys(r).forEach((e=>{r[e]=[...r[e]]})),r}({components:e});let n=[];return o.type.isArray(e.config.auth.pages.public)&&(n=e.config.auth.pages.public),(e.pages||[]).forEach((e=>{if(r[e.id]){if(n.includes(e.id))throw new Error(`Page "${e.id}" is both protected by roles ${JSON.stringify(r[e.id])} and public.`);e.auth={public:!1,roles:r[e.id]}}else t.includes(e.id)?e.auth={public:!1}:e.auth={public:!0}})),e};function w(e,t,r,n){o.type.isArray(e.links)&&(e.links.forEach((e=>{if("MenuLink"===e.type)if(o.type.isString(e.pageId)){const t=r.find((t=>t.pageId===e.pageId));if(!t)return n.push({menuItemId:e.id,pageId:e.pageId}),void(e.remove=!0);e.auth=t.auth}else e.auth={public:!0};"MenuGroup"===e.type&&(e.auth={public:!0}),e.menuItemId=e.id,e.id=`menuitem:${t}:${e.id}`,w(e,t,r,n)})),e.links=e.links.filter((e=>!0!==e.remove)))}const k=async function({components:e,context:t}){const r=o.type.isArray(e.pages)?e.pages:[];(o.type.isUndefined(e.menus)||0===e.menus.length)&&(e.menus=await async function({components:e,context:t}){return t.logger.warn("No menus found. Building default menu."),[{id:"default",links:(o.type.isArray(e.pages)?e.pages:[]).map(((e,t)=>({id:`${t}`,type:"MenuLink",pageId:e.pageId,auth:e.auth}))).filter((e=>"404"!==e.pageId))}]}({components:e,context:t}));const n=[];return e.menus.forEach((e=>{e.menuId=e.id,e.id=`menu:${e.id}`,w(e,e.menuId,r,n)})),await Promise.all(n.map((async e=>{await t.logger.warn(`Page "${e.pageId}" referenced in menu link "${e.menuItemId}" not found.`)}))),e},$=async function e(t,r){if(!o.type.isObject(t))throw new Error(`Expected block to be an object on ${r.pageId}. Received ${JSON.stringify(t)}`);if(!o.type.isString(t.id)){if(o.type.isUndefined(t.id))throw new Error(`Block id missing at page "${r.pageId}".`);throw new Error(`Block id is not a string at page "${r.pageId}". Received ${JSON.stringify(t.id)}.`)}t.blockId=t.id,t.id=`block:${r.pageId}:${t.id}`,await async function(e,{getMeta:t,pageId:r}){if(o.type.isNone(e.type))throw new Error(`Block type is not defined at ${e.blockId} on page ${r}.`);if(!o.type.isString(e.type))throw new Error(`Block type is not a string at ${e.blockId} on page ${r}. Received ${JSON.stringify(e.type)}`);const n=await t(e.type);if(!n)throw new Error(`Invalid Block type at ${e.blockId} on page ${r}. Received ${JSON.stringify(e.type)}`);const{category:a,loading:s,moduleFederation:i,valueType:c}=n;e.meta={category:a,loading:s,moduleFederation:i},"input"===a&&(e.meta.valueType=c),"list"===a&&(e.meta.valueType="array"),e.loading&&(e.meta.loading=e.loading)}(t,r);let n=r;if("context"===t.meta.category&&(n={auth:r.auth,contextId:t.blockId,getMeta:r.getMeta,pageId:r.pageId,requests:[]}),function(e,t){if(!o.type.isNone(e.requests)){if(!o.type.isArray(e.requests))throw new Error(`Requests is not an array at ${e.blockId} on page ${t.pageId}. Received ${JSON.stringify(e.requests)}`);e.requests.forEach((e=>{!function(e,t){const{auth:r,contextId:n,pageId:a}=t;if(!o.type.isString(e.id)){if(o.type.isUndefined(e.id))throw new Error(`Request id missing at page "${a}".`);throw new Error(`Request id is not a string at page "${a}". Received ${JSON.stringify(e.id)}.`)}if(e.id.includes("."))throw new Error(`Request id "${e.id}" should not include a period (".").`);e.auth=r,e.requestId=e.id,e.contextId=n,e.id=`request:${a}:${n}:${e.id}`,t.requests.push(e)}(e,t)})),delete e.requests}}(t,n),"context"===t.meta.category&&(t.requests=n.requests),t.events&&Object.keys(t.events).map((e=>{if(o.type.isArray(t.events[e])&&(t.events[e]={try:t.events[e],catch:[]}),!o.type.isArray(t.events[e].try))throw new Error(`Events must be an array of actions at ${t.blockId} in events ${e} on page ${n.pageId}. Received ${JSON.stringify(t.events[e].try)}`);if(!o.type.isArray(t.events[e].catch)&&!o.type.isNone(t.events[e].catch))throw new Error(`Catch events must be an array of actions at ${t.blockId} in events ${e} on page ${n.pageId}. Received ${JSON.stringify(t.events[e].catch)}`)})),!o.type.isNone(t.blocks)){if(!o.type.isArray(t.blocks))throw new Error(`Blocks at ${t.blockId} on page ${n.pageId} is not an array. Received ${JSON.stringify(t.blocks)}`);(0,o.set)(t,"areas.content.blocks",t.blocks),delete t.blocks}if(o.type.isObject(t.areas)){let r=[];Object.keys(t.areas).forEach((a=>{if(o.type.isNone(t.areas[a].blocks)&&(t.areas[a].blocks=[]),!o.type.isArray(t.areas[a].blocks))throw new Error(`Expected blocks to be an array at ${t.blockId} in area ${a} on page ${n.pageId}. Received ${JSON.stringify(t.areas[a].blocks)}`);const s=t.areas[a].blocks.map((async t=>{await e(t,n)}));r=r.concat(s)})),await Promise.all(r)}},j=function e(t){"context"===(0,o.get)(t,"meta.category")&&(t.operators=function(e){const{requests:t,...r}=e;r.areas=JSON.parse(JSON.stringify(r.areas||{}),((e,t)=>"context"===(0,o.get)(t,"meta.category")?null:t));const n=new Set;return JSON.parse(JSON.stringify(r),((e,t)=>{if(o.type.isObject(t)&&1===Object.keys(t).length){const e=Object.keys(t)[0],[r]=e.split("."),o=r.replace(/^(_+)/gm,"_");o.length>1&&"_"===o[0]&&n.add(o)}return t})),[...n]}(t)),Object.keys(t.areas||{}).forEach((r=>{t.areas[r].blocks.map((t=>{e(t)}))}))},_=async function({components:e,context:t}){const r=(o.type.isArray(e.pages)?e.pages:[]).map((async(e,r)=>{if(!o.type.isString(e.id)){if(o.type.isUndefined(e.id))throw new Error(`Page id missing at page ${r}.`);throw new Error(`Page id is not a string at at page ${r}. Received ${JSON.stringify(e.id)}.`)}e.pageId=e.id,await async function(e,{getMeta:t}){if(o.type.isNone(e.type))throw new Error(`Page type is not defined at ${e.pageId}.`);if(!o.type.isString(e.type))throw new Error(`Page type is not a string at ${e.pageId}. Received ${JSON.stringify(e.type)}`);const r=await t(e.type);if(!r)throw new Error(`Invalid block type at page ${e.pageId}. Received ${JSON.stringify(e.type)}`);if("context"!==r.category)throw new Error(`Page ${e.pageId} is not of category "context". Received ${JSON.stringify(e.type)}`)}(e,t),await $(e,{auth:e.auth,pageId:e.pageId,requests:[],getMeta:t.getMeta}),e.id=`page:${e.pageId}`,j(e)}));return await Promise.all(r),e},v=async function({context:e,refDef:t,referencedFrom:r}){if(!o.type.isString(t.path))throw new Error(`Invalid _ref definition ${JSON.stringify({_ref:t.original})} in file ${r}`);const n=e.readConfigFile(t.path);if(null===n)throw new Error(`Tried to reference file "${t.path}" from "${r}", but file does not exist.`);return n};var M=r(8227),S=r.n(M),I=r(3404),P=r.n(I),E=r(2466);const x=function({content:e,refDef:t}){const{path:r,vars:n}=t;if(o.type.isString(r)){let t=(0,i.getFileExtension)(r);if("njk"===t&&(e=function(e,t){return(0,E.nunjucksFunction)(e)(t)}(e,n),t=(0,i.getFileSubExtension)(r)),"yaml"===t||"yml"===t)return P().load(e);if("json"===t)return S().parse(e)}return e};var A=r(4116);const O=async function({context:e,refDef:t,referencedFrom:r}){let n;return n="lowdefy.yaml"===t.path?await v({context:e,refDef:t,referencedFrom:r}):t.resolver||e.refResolver?await async function({context:e,refDef:t,referencedFrom:r}){const n=await(0,A.Z)({context:e,filePath:t.resolver||e.refResolver});let a;try{a=await n(t.path,t.vars,e)}catch(e){throw new Error(`Error calling resolver "${t.resolver}" from "${r}": ${e.message}`)}if(o.type.isNone(a))throw new Error(`Tried to reference with resolver "${t.resolver}" from "${r}", but received "${a}".`);return a}({context:e,refDef:t,referencedFrom:r}):await v({context:e,refDef:t,referencedFrom:r}),x({content:n,refDef:t})};var C=r(8434);const N=function(e){if(o.type.isObject(e)){if(e.path)return e.path;if(e._var)return e}return o.type.isString(e)?e:null},q=function(e){return{id:(0,C.v1)(),original:e,path:N(e),resolver:(0,o.get)(e,"resolver"),transformer:(0,o.get)(e,"transformer"),vars:(0,o.get)(e,"vars",{default:{}})}};function D(e,t){if(o.type.isObject(t)){if(!o.type.isUndefined(t._ref))return this.parsedFiles[t._ref.id];if(t._var){if(o.type.isString(t._var))return JSON.parse(JSON.stringify((0,o.get)(this.vars,t._var,{default:null})));if(o.type.isObject(t._var)&&o.type.isString(t._var.name))return JSON.parse(JSON.stringify((0,o.get)(this.vars,t._var.name,{default:o.type.isNone(t._var.default)?null:t._var.default})));throw new Error(`"_var" operator takes a string or object with name field as arguments. Received "${JSON.stringify(t)}"`)}}return t}const B=function({parsedFiles:e,refDef:t,toPopulate:r}){return JSON.parse(JSON.stringify(r),D.bind({parsedFiles:e,vars:t.vars}))},R=async function({context:e,parsedFile:t,refDef:r}){return r.transformer?(await(0,A.Z)({context:e,filePath:r.transformer}))(t,r.vars):t},J=async function e({context:t,refDef:r,count:n,referencedFrom:a}){if(n>40)throw new Error("Maximum recursion depth of references exceeded.");let s=await O({context:t,refDef:r,referencedFrom:a});const{foundRefs:i,fileContentBuiltRefs:c}=function(e){const t=[],r=JSON.parse(JSON.stringify(e),((e,r)=>{if(o.type.isObject(r)&&!o.type.isUndefined(r._ref)){const e=q(r._ref);return t.push(e),{_ref:e}}return r}));return{foundRefs:t,fileContentBuiltRefs:r}}(s),p={};for(const o of i.values()){const a=B({toPopulate:o,parsedFiles:p,refDef:r}),s=await e({context:t,refDef:a,count:n+1,referencedFrom:r.path}),i=await R({context:t,parsedFile:s,refDef:a});p[o.id]=i}return B({toPopulate:c,parsedFiles:p,refDef:r})};var F=r(570);const T=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://lowdefy.com/appSchema.json","type":"object","title":"Lowdefy App Schema","definitions":{"action":{"type":"object","additionalProperties":false,"required":["id","type"],"properties":{"async":{"type":"boolean","errorMessage":{"type":"Action \\"async\\" should be a boolean."}},"id":{"type":"string","errorMessage":{"type":"Action \\"id\\" should be a string."}},"messages":{},"params":{},"skip":{},"type":{"type":"string","errorMessage":{"type":"Action \\"type\\" should be a string."}}},"errorMessage":{"type":"Action should be an object.","required":{"id":"Action should have required property \\"id\\".","type":"Action should have required property \\"type\\"."}}},"app":{"type":"object","additionalProperties":false,"properties":{"html":{"type":"object","errorMessage":{"type":"App \\"app.html\\" should be an object."},"properties":{"appendBody":{"type":"string","errorMessage":{"type":"App \\"app.html.appendBody\\" should be a string."}},"appendHead":{"type":"string","errorMessage":{"type":"App \\"app.html.appendHead\\" should be a string."}}}}}},"authConfig":{"type":"object","additionalProperties":false,"errorMessage":{"type":"App \\"config.auth\\" should be an object."},"properties":{"openId":{"type":"object","additionalProperties":false,"errorMessage":{"type":"App \\"config.auth.openId\\" should be an object."},"properties":{"rolesField":{"type":"string","description":".","errorMessage":{"type":"App \\"config.auth.openId.rolesField\\" should be a string."}},"logoutRedirectUri":{"type":"string","description":"The URI to redirect the user to after logout. Can be a Nunjucks template string with client_id, host, id_token_hint, and openid_domain as template data.","errorMessage":{"type":"App \\"config.auth.openId.logoutRedirectUri\\" should be a string."}},"scope":{"type":"string","description":"The OpenID Connect scope to request.","default":"openid profile email","errorMessage":{"type":"App \\"config.auth.openId.scope\\" should be a string."}}}},"pages":{"type":"object","additionalProperties":false,"errorMessage":{"type":"App \\"config.auth.pages\\" should be an object."},"properties":{"protected":{"type":["array","boolean"],"errorMessage":{"type":"App \\"config.auth.pages.protected.$\\" should be an array of strings."},"items":{"type":"string","description":"Page ids for which authentication is required. When specified, all unspecified pages will be public.","errorMessage":{"type":"App \\"config.auth.pages.protected.$\\" should be an array of strings."}}},"public":{"type":["array","boolean"],"errorMessage":{"type":"App \\"config.auth.pages.public.$\\" should be an array of strings."},"items":{"type":"string","description":"Page ids for which authentication is not required. When specified, all unspecified pages will be protected.","errorMessage":{"type":"App \\"config.auth.pages.public.$\\" should be an array of strings."}}},"roles":{"type":"object","patternProperties":{"^.*$":{"type":"array","items":{"type":"string"},"errorMessage":{"type":"App \\"config.auth.pages.roles.[role]\\" should be an array of strings."}}},"errorMessage":{"type":"App \\"config.auth.pages.roles\\" should be an object."}}}},"jwt":{"type":"object","additionalProperties":false,"errorMessage":{"type":"App \\"config.auth.jwt\\" should be an object."},"properties":{"expiresIn":{"type":["string","number"],"default":"4h","description":"The length of time a user token should be valid. Can be expressed as a number in seconds, or a vercel/ms string (https://github.com/vercel/ms)","errorMessage":{"type":"App \\"config.auth.jwt.expiresIn\\" should be a string or number."}},"loginStateExpiresIn":{"type":["string","number"],"default":"5min","description":"The length of time an authorization request token should be valid. Can be expressed as a number in seconds, or a vercel/ms string (https://github.com/vercel/ms)","errorMessage":{"type":"App \\"config.auth.jwt.loginStateExpiresIn\\" should be a string or number."}}}}}},"block":{"type":"object","additionalProperties":false,"required":["id","type"],"properties":{"id":{"type":"string","errorMessage":{"type":"Block \\"id\\" should be a string."}},"type":{"type":"string","errorMessage":{"type":"Block \\"type\\" should be a string."}},"field":{"type":"string","errorMessage":{"type":"Block \\"field\\" should be a string."}},"properties":{"type":"object"},"layout":{"type":"object","errorMessage":{"type":"Block \\"layout\\" should be an object."}},"loading":{"type":"object","errorMessage":{"type":"Block \\"loading\\" should be an object."}},"style":{"type":"object","errorMessage":{"type":"Block \\"style\\" should be an object."}},"visible":{},"blocks":{"type":"array","items":{"$ref":"#/definitions/block"},"errorMessage":{"type":"Block \\"blocks\\" should be an array."}},"requests":{"type":"array","items":{"$ref":"#/definitions/request"},"errorMessage":{"type":"Block \\"requests\\" should be an array."}},"required":{},"validate":{"type":"array","items":{"type":"object","errorMessage":{"type":"Block \\"validate\\" should be an array of objects."}},"errorMessage":{"type":"Block \\"validate\\" should be an array."}},"events":{"type":"object","patternProperties":{"^.*$":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/action"}},{"type":"object","additionalProperties":false,"properties":{"try":{"type":"array","items":{"$ref":"#/definitions/action"}},"catch":{"type":"array","items":{"$ref":"#/definitions/action"}},"debounce":{"type":"object","additionalProperties":false,"properties":{"immediate":{"type":"boolean","errorMessage":{"type":"Event \\"debounce.immediate\\" should be an boolean."}},"ms":{"type":"number","errorMessage":{"type":"Event \\"debounce.ms\\" should be a number."}}}}}}]}},"errorMessage":{"type":"Block \\"events\\" should be an object."}},"areas":{"type":"object","patternProperties":{"^.*$":{"type":"object","properties":{"blocks":{"type":"array","items":{"$ref":"#/definitions/block"},"errorMessage":{"type":"Block \\"areas.{areaKey}.blocks\\" should be an array."}}},"errorMessage":{"type":"Block \\"areas.{areaKey}\\" should be an object."}}},"errorMessage":{"type":"Block \\"areas\\" should be an object."}}},"errorMessage":{"type":"Block should be an object.","required":{"id":"Block should have required property \\"id\\".","type":"Block should have required property \\"type\\"."}}},"connection":{"type":"object","additionalProperties":false,"required":["id","type"],"properties":{"id":{"type":"string","errorMessage":{"type":"Connection \\"id\\" should be a string."}},"type":{"type":"string","errorMessage":{"type":"Connection \\"type\\" should be a string."}},"properties":{"type":"object","errorMessage":{"type":"Connection \\"properties\\" should be an object."}}},"errorMessage":{"type":"Connection should be an object.","required":{"id":"Connection should have required property \\"id\\".","type":"Connection should have required property \\"type\\"."}}},"menu":{"type":"object","additionalProperties":false,"required":["id"],"properties":{"id":{"type":"string","errorMessage":{"type":"Menu \\"id\\" should be a string."}},"properties":{"type":"object","errorMessage":{"type":"Menu \\"properties\\" should be an object."}},"links":{"type":"array","items":{"$ref":"#/definitions/menuItem"},"errorMessage":{"type":"Menu \\"links\\" should be an array."}}},"errorMessage":{"type":"Menu should be an object.","required":{"id":"Menu should have required property \\"id\\"."}}},"menuGroup":{"type":"object","additionalProperties":false,"required":["id","type"],"properties":{"id":{"type":"string","errorMessage":{"type":"MenuGroup \\"id\\" should be a string."}},"type":{"type":"string","errorMessage":{"type":"MenuGroup \\"type\\" should be a string."}},"properties":{"type":"object","errorMessage":{"type":"MenuGroup \\"properties\\" should be an object."}},"links":{"type":"array","items":{"$ref":"#/definitions/menuItem"},"errorMessage":{"type":"MenuGroup \\"links\\" should be an array."}}},"errorMessage":{"type":"MenuGroup should be an object.","required":{"id":"MenuGroup should have required property \\"id\\".","type":"MenuGroup should have required property \\"type\\"."}}},"menuItem":{"anyOf":[{"$ref":"#/definitions/menuGroup"},{"$ref":"#/definitions/menuLink"}]},"menuLink":{"type":"object","additionalProperties":false,"required":["id","type"],"properties":{"id":{"type":"string","errorMessage":{"type":"MenuLink \\"id\\" should be a string."}},"type":{"type":"string","errorMessage":{"type":"MenuLink \\"type\\" should be a string."}},"pageId":{"type":"string","errorMessage":{"type":"MenuLink \\"pageId\\" should be a string."}},"url":{"type":"string","errorMessage":{"type":"MenuLink \\"url\\" should be a string."}},"properties":{"type":"object","errorMessage":{"type":"MenuLink \\"properties\\" should be an object."}}},"errorMessage":{"type":"MenuLink should be an object.","required":{"id":"MenuLink should have required property \\"id\\".","type":"MenuLink should have required property \\"type\\"."}}},"request":{"type":"object","additionalProperties":false,"required":["id","type","connectionId"],"properties":{"id":{"type":"string","errorMessage":{"type":"Request \\"id\\" should be a string."}},"type":{"type":"string","errorMessage":{"type":"Request \\"type\\" should be a string."}},"connectionId":{"type":"string","errorMessage":{"type":"Request \\"connectionId\\" should be a string."}},"properties":{"type":"object","errorMessage":{"type":"Request \\"properties\\" should be an object."}}},"errorMessage":{"type":"Request should be an object.","required":{"id":"Request should have required property \\"id\\".","type":"Request should have required property \\"type\\".","connectionId":"Request should have required property \\"connectionId\\"."}}}},"additionalProperties":false,"required":["lowdefy"],"properties":{"name":{"type":"string","errorMessage":{"type":"App \\"name\\" should be a string."}},"lowdefy":{"type":"string","errorMessage":{"type":"Lowdefy version in field \\"lowdefy\\" should be a string."}},"licence":{"type":"string","errorMessage":{"type":"App \\"licence\\" should be a string."}},"app":{"$ref":"#/definitions/app"},"cli":{"type":"object","errorMessage":{"type":"App \\"cli\\" should be an object."}},"config":{"type":"object","errorMessage":{"type":"App \\"config\\" should be an object."},"additionalProperties":false,"properties":{"homePageId":{"type":"string","description":"Page id to use as homepage. When visiting home route \\"/\\", the router will redirect to this page. If not provided, the first page in default or first menu will be used as the homePageId.","errorMessage":{"type":"App \\"config.homePageId\\" should be a string."}},"experimental_initPageId":{"type":"string","description":"Id of the page to load when app is first run. After loading it, app will redirect to the requested page.","errorMessage":{"type":"App \\"config.experimental_initPageId\\" should be a string."}},"auth":{"$ref":"#/definitions/authConfig"}}},"types":{"type":"object","patternProperties":{"^.*$":{"url":"string","errorMessage":{"enum":"Type \\"url\\" should be a string."}}},"errorMessage":{"type":"App \\"types\\" should be an object."}},"global":{"type":"object","errorMessage":{"type":"App \\"global\\" should be an object."}},"connections":{"type":"array","items":{"$ref":"#/definitions/connection"},"errorMessage":{"type":"App \\"connections\\" should be an array."}},"menus":{"type":"array","items":{"$ref":"#/definitions/menu"},"errorMessage":{"type":"App \\"menus\\" should be an array."}},"pages":{"type":"array","items":{"$ref":"#/definitions/block"},"errorMessage":{"type":"App \\"pages\\" should be an array."}}},"errorMessage":{"type":"Lowdefy configuration should be an object.","required":{"lowdefy":"Lowdefy configuration should have required property \\"lowdefy\\"."}}}');function L({data:e,dataPath:t,formattedPath:r="",gap:n="",root:a=!1}){if(0===t.length)return r;const s=t.shift(),i=(0,o.get)(e,s);let c;return c=o.type.isArray(e)?`${r}\n${n+=" "}- ${function({index:e,object:t}){return o.type.isNone(t.id)&&o.type.isNone(t.type)?`[${e}]`:`[${e}:${o.type.isNone(t.id)?"_ERROR_MISSING_ID_":t.id}:${o.type.isNone(t.type)?"_ERROR_MISSING_TYPE_":t.type}]`}({index:s,object:i})}`:`${r}${a?"- ":"."}${s}`,L({data:i,dataPath:t,formattedPath:c,gap:n})}const U=function({error:e,components:t}){const r=L({data:t,dataPath:e.dataPath.split("/").slice(1),root:!0});return`Schema Error\n${e.message}\n${r}`};function H({block:e,requests:t,pageId:r}){if(!o.type.isObject(e))throw new Error(`Block is not an object on page "${r}".`);if(!o.type.isNone(e.requests)){if(!o.type.isArray(e.requests))throw new Error(`Requests is not an array on page "${r}".`);e.requests.forEach((e=>{t.push(o.serializer.copy(e)),delete e.properties}))}o.type.isObject(e.areas)&&Object.keys(e.areas).forEach((n=>{if(!o.type.isArray(e.areas[n].blocks))throw new Error(`Blocks is not an array on page "${r}", block "${e.blockId}", area "${n}".`);e.areas[n].blocks.forEach((e=>{H({block:e,requests:t,pageId:r})}))}))}async function W({page:e,context:t}){if(!o.type.isObject(e))throw new Error("Page is not an object.");const r=[];return H({block:e,requests:r,pageId:e.pageId}),r.map((async r=>{await t.writeBuildArtifact({filePath:`pages/${e.pageId}/requests/${r.contextId}/${r.requestId}.json`,content:JSON.stringify(r,null,2)})}))}function G(e){const{blocksServerUrl:t,cacheDirectory:r,configDirectory:o,logger:n,outputDirectory:a,refResolver:s}=e;return{writeBuildArtifact:f({outputDirectory:a}),readConfigFile:b({configDirectory:o}),blocksServerUrl:t,cacheDirectory:r,configDirectory:o,logger:n,outputDirectory:a,refResolver:s}}const K=async function(e){const t=G(e);try{let e=await async function({context:e}){return J({context:e,refDef:q("lowdefy.yaml"),count:0})}({context:t});await async function({components:e,context:t}){const{valid:r,errors:o}=(0,F.validate)({schema:T,data:e,returnErrors:!0});if(!r){await t.logger.warn("Schema not valid.");const r=o.map((r=>t.logger.warn(U({error:r,components:e}))));await r}}({components:e,context:t}),t.getMeta=g({components:e,context:t}),await async function({components:e}){if(o.type.isNone(e.app)&&(e.app={}),!o.type.isObject(e.app))throw new Error("lowdefy.app is not an object.");return o.type.isNone(e.app.html)&&(e.app.html={}),o.type.isNone(e.app.html.appendBody)&&(e.app.html.appendBody=""),o.type.isNone(e.app.html.appendHead)&&(e.app.html.appendHead=""),e}({components:e,context:t}),await async function({components:e}){if(o.type.isNone(e.config)&&(e.config={}),!o.type.isObject(e.config))throw new Error("lowdefy.config is not an object.");if(o.type.isNone(e.config.auth)&&(e.config.auth={}),o.type.isNone(e.config.auth.pages)&&(e.config.auth.pages={}),o.type.isNone(e.config.auth.pages.roles)&&(e.config.auth.pages.roles={}),(0,F.validate)({schema:T.definitions.authConfig,data:e.config.auth}),!0===e.config.auth.pages.protected&&!0===e.config.auth.pages.public||o.type.isArray(e.config.auth.pages.protected)&&o.type.isArray(e.config.auth.pages.public))throw new Error("Protected and public pages are mutually exclusive. When protected pages are listed, all unlisted pages are public by default and visa versa.");if(!1===e.config.auth.pages.protected)throw new Error("Protected pages can not be set to false.");if(!1===e.config.auth.pages.public)throw new Error("Public pages can not be set to false.");return e}({components:e,context:t}),await async function({components:e}){const t=[JSON.parse(JSON.stringify(h))];if(o.type.isNone(e.pages)&&(e.pages=[]),!o.type.isArray(e.pages))throw new Error("lowdefy.pages is not an array.");const r=e.pages.map((e=>e.id)),n=t.filter((e=>!r.includes(e.id)));return e.pages=[...e.pages,...n],e}({components:e,context:t}),await m({components:e,context:t}),await async function({components:e}){return o.type.isArray(e.connections)&&e.connections.forEach((e=>{e.connectionId=e.id,e.id=`connection:${e.id}`})),e}({components:e,context:t}),await _({components:e,context:t}),await k({components:e,context:t}),await async function({context:e}){return(0,i.cleanDirectory)(e.outputDirectory)}({context:t}),await async function({components:e,context:t}){await t.writeBuildArtifact({filePath:"app.json",content:JSON.stringify(e.app||{},null,2)})}({components:e,context:t}),await async function({components:e,context:t}){if(o.type.isNone(e.connections))return;if(!o.type.isArray(e.connections))throw new Error("Connections is not an array.");const r=e.connections.map((async e=>{await t.writeBuildArtifact({filePath:`connections/${e.connectionId}.json`,content:JSON.stringify(e,null,2)})}));return Promise.all(r)}({components:e,context:t}),await async function({components:e,context:t}){if(o.type.isNone(e.pages))return;if(!o.type.isArray(e.pages))throw new Error("Pages is not an array.");const r=e.pages.map((e=>W({page:e,context:t})));return Promise.all(r)}({components:e,context:t}),await async function({components:e,context:t}){if(o.type.isNone(e.pages))return;if(!o.type.isArray(e.pages))throw new Error("Pages is not an array.");const r=e.pages.map((e=>async function({page:e,context:t}){if(!o.type.isObject(e))throw new Error(`Page is not an object. Received ${JSON.stringify(e)}`);await t.writeBuildArtifact({filePath:`pages/${e.pageId}/${e.pageId}.json`,content:JSON.stringify(e,null,2)})}({page:e,context:t})));return Promise.all(r)}({components:e,context:t}),await async function({components:e,context:t}){await t.writeBuildArtifact({filePath:"config.json",content:JSON.stringify(e.config||{},null,2)})}({components:e,context:t}),await async function({components:e,context:t}){if(o.type.isNone(e.global)&&(e.global={}),!o.type.isObject(e.global))throw new Error("Global is not an object.");await t.writeBuildArtifact({filePath:"global.json",content:JSON.stringify(e.global,null,2)})}({components:e,context:t}),await async function({components:e,context:t}){if(!o.type.isArray(e.menus))throw new Error("Menus is not an array.");await t.writeBuildArtifact({filePath:"menus.json",content:JSON.stringify(e.menus,null,2)})}({components:e,context:t})}catch(e){throw t.logger.error(e),e}}},4116:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var path__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5622),path__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__),_lowdefy_node_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9189),_lowdefy_node_utils__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_lowdefy_node_utils__WEBPACK_IMPORTED_MODULE_1__);async function getUserJavascriptFunction({context,filePath}){const jsFile=await(0,_lowdefy_node_utils__WEBPACK_IMPORTED_MODULE_1__.readFile)(path__WEBPACK_IMPORTED_MODULE_0___default().resolve(context.configDirectory,filePath));return eval(jsFile)}const __WEBPACK_DEFAULT_EXPORT__=getUserJavascriptFunction}};